SELECT question,
COUNT(DISTINCT user_id) AS 'Number of Responses'
FROM survey
GROUP BY 1;

SELECT question, 
response
FROM survey
GROUP BY 1, 2;

SELECT DISTINCT q.user_id, 
h.user_id IS NOT NULL AS is_home_try_on, 
h.number_of_pairs,
p.user_id IS NOT NULL AS is_purchase
FROM quiz AS q
LEFT JOIN home_try_on AS h
ON q.user_id = h.user_id
LEFT JOIN purchase AS p
ON h.user_id = p.user_id
LIMIT 10;

WITH purchase_funnel AS
	(SELECT DISTINCT q.user_id,
    h.user_id IS NOT NULL AS is_home_try_on, 
    h.number_of_pairs,
	p.user_id IS NOT NULL AS is_purchase
	FROM quiz AS q
	LEFT JOIN home_try_on AS h
	ON q.user_id = h.user_id
	LEFT JOIN purchase AS p
	ON h.user_id = p.user_id)
SELECT COUNT(*) AS 'number of quiz takers'
FROM purchase_funnel;

WITH purchase_funnel AS
	(SELECT DISTINCT q.user_id,
    h.user_id IS NOT NULL AS is_home_try_on, 
    h.number_of_pairs,
	p.user_id IS NOT NULL AS is_purchase
	FROM quiz AS q
	LEFT JOIN home_try_on AS h
	ON q.user_id = h.user_id
	LEFT JOIN purchase AS p
	ON h.user_id = p.user_id)
SELECT COUNT(*) AS 'number of quiz takers',
	SUM(is_home_try_on) AS 'number of home try-ons',
    SUM(is_purchase) AS 'number of purchases',
	1.0 * SUM(is_home_try_on) / COUNT(*) AS 'quiz to home try-on conversion rate',
    1.0 * SUM(is_purchase) / SUM(is_home_try_on) AS 'home try-on to purchase conversion'
FROM purchase_funnel;

WITH purchase_funnel AS
	(SELECT DISTINCT q.user_id,
    h.user_id IS NOT NULL AS is_home_try_on, 
    h.number_of_pairs,
	p.user_id IS NOT NULL AS is_purchase
	FROM quiz AS q
	LEFT JOIN home_try_on AS h
	ON q.user_id = h.user_iLEFT JOIN purchase AS p
	ON h.user_id = p.user_id)
SELECT number_of_pairs,
	SUM(is_home_try_on) AS 'number of home try-ons',
    SUM(is_purchase) AS 'number of purchases',
	ROUND(1.0 * SUM(is_purchase) / SUM(is_home_try_on), 2) AS 'home try-on to purchase conversion'
FROM purchase_funnel
WHERE number_of_pairs IS NOT NULL
GROUP BY number_of_pairs;


SELECT COUNT(*) AS 'Number of Responses',
style, fit, shape, color
FROM quiz
GROUP BY style, fit, shape, color
ORDER BY COUNT(*)DESC
LIMIT 10;

SELECT style, 
COUNT(*) AS 'Number of Responses'
FROM quiz
GROUP BY 1
ORDER BY 2 DESC;

SELECT fit, 
COUNT(*) AS 'Number of Responses'
FROM quiz
GROUP BY 1
ORDER BY 2 DESC;
    
SELECT shape, 
COUNT(*) AS 'Number of Responses'
FROM quiz
GROUP BY 1
ORDER BY 2 DESC;

SELECT color, 
COUNT(*) AS 'Number of Responses'
FROM quiz
GROUP BY 1
ORDER BY 2 DESC;

SELECT COUNT(*) AS 'number of purchases',
style, model_name, color, price
FROM purchase
GROUP BY product_id
ORDER BY 1 DESC;

SELECT COUNT(*) AS 'number of purchases',
model_name, color, price
FROM purchase
WHERE style = 'Men''s Styles'
GROUP BY product_id
ORDER BY 1 DESC;

SELECT COUNT(*) AS 'number of purchases',
model_name, color, price
FROM purchase
WHERE style = 'Women''s Styles'
GROUP BY product_id
ORDER BY 1 DESC;

SELECT COUNT(DISTINCT product_id) AS 'Total purchase options'
FROM purchase;

SELECT DISTINCT product_id, 
style, model_name, color, price
FROM purchase
GROUP BY 1;

SELECT q.fit,
p.product_id, p.style, p.model_name, COUNT(*)
FROM quiz AS q
LEFT JOIN purchase AS p
ON q.user_id = p.user_id
WHERE q.fit = 'I''m not sure. Let''s skip it.'
GROUP BY p.model_name
ORDER BY COUNT(*) DESC;
